<!DOCTYPE html>
<html lang="fa">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
<title>Flappy Bird افقی حرفه‌ای</title>
<style>
  html, body {
    margin: 0; padding: 0; overflow: hidden; height: 100%;
    background: #000;
    font-family: 'Vazir', sans-serif;
  }
  #gameCanvas {
    display: block;
    background: url('https://s6.uupload.ir/files/28ba5059824647.5a309e5d410de_3m3r.jpg') no-repeat center center;
    background-size: cover;
    width: 100vw;
    height: 100vh;
    touch-action: none;
    position: relative;
    z-index: 1;
  }
  #rotateScreen {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: rgba(0, 0, 0, 0.65);
    color: #fff;
    font-size: 18px;
    font-weight: bold;
    font-family: monospace;
    padding: 14px 20px;
    border: 2px dashed #fff;
    border-radius: 10px;
    text-align: center;
    z-index: 1200;
    pointer-events: none;
    animation: pulse 2s infinite;
  }
  @keyframes pulse {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    50% { transform: translate(-50%, -50%) scale(1.1); opacity: 0.7; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
  #loading {
    position: fixed; top: 50%; left: 50%;
    transform: translate(-50%, -50%);
    font-size: 36px; color: #ff3f3f;
    font-weight: 900;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    text-shadow:
      0 0 15px #ff3f3f,
      0 0 30px #ff3f3f,
      0 0 40px #ff3f3f,
      0 0 60px #ff3f3f;
    letter-spacing: 6px;
    display: none;
    z-index: 1100;
    user-select: none;
  }
  @keyframes wave {
    0%, 100% { text-shadow: 0 0 15px #ff3f3f; }
    50% { text-shadow: 0 0 30px #ff0000, 0 0 40px #ff0000; }
  }
  #loading span {
    display: inline-block;
    animation: wave 1.5s infinite ease-in-out;
  }
  #bloodOverlay {
    position: fixed; top:0; left:0; width:100vw; height:100vh;
    pointer-events:none;
    z-index: 1300;
    mix-blend-mode: multiply;
  }
</style>
</head>
<body>

<canvas id="gameCanvas"></canvas>
<div id="rotateScreen">PLEASE ROTATE YOUR DEVICE TO LANDSCAPE</div>
<div id="loading"><span>LOADING</span></div>
<canvas id="bloodOverlay"></canvas>

<script>
  const canvas = document.getElementById('gameCanvas');
  const ctx = canvas.getContext('2d');
  const rotateScreen = document.getElementById('rotateScreen');
  const loading = document.getElementById('loading');
  const bloodCanvas = document.getElementById('bloodOverlay');
  const bloodCtx = bloodCanvas.getContext('2d');

  let W, H;
  let gameStarted = false;
  let gameOver = false;
  let bird;
  let birdImg = new Image();
  birdImg.src = "https://s6.uupload.ir/files/a-vibrant-blue-and-yellow-bird-in-mid-flight-cut-out-stock-png_ohfh.png";
  let obstacles = [];
  let speed = 2.2;
  let score = 0;
  let difficultyIncrement = 0;
  let maxDifficulty = 3;
  let loadingDuration = 3000;
  let bloodParticles = [];

  function resize() {
    W = window.innerWidth;
    H = window.innerHeight;
    canvas.width = W;
    canvas.height = H;
    bloodCanvas.width = W;
    bloodCanvas.height = H;
  }
  resize();

  function checkOrientation() {
    if(window.innerWidth < window.innerHeight){
      rotateScreen.style.display = "block";
      canvas.style.display = "none";
      bloodCanvas.style.display = "none";
      return false;
    } else {
      rotateScreen.style.display = "none";
      canvas.style.display = "block";
      bloodCanvas.style.display = "block";
      return true;
    }
  }

  class Bird {
    constructor() {
      this.radius = 22;
      this.x = W / 4;
      this.y = H / 2;
      this.velocity = 0;
      this.gravity = 0.25;
      this.lift = -6;
      this.isMoving = false;
      this.dead = false;
    }
    update() {
      if(!this.isMoving) return;
      this.velocity += this.gravity;
      this.velocity *= 0.98;
      this.y += this.velocity;

      if(this.y + this.radius > H){
        this.y = H - this.radius;
        this.velocity = 0;
        this.dead = true;
        gameOver = true;
        createBloodFountain(this.x, this.y);
        shakeScreen();
      }
      if(this.y - this.radius < 0){
        this.y = this.radius;
        this.velocity = 0;
      }
    }
    flap() {
      if(this.dead) return;
      this.velocity += this.lift;
    }
    draw() {
      ctx.save();
      ctx.drawImage(birdImg, this.x - this.radius, this.y - this.radius, this.radius * 2, this.radius * 2);
      ctx.restore();
    }
  }

  class Obstacle {
    constructor() {
      this.top = Math.random() * (H / 2);
      this.bottom = H - (this.top + 180);
      this.x = W;
      this.w = 50;
      this.speed = speed;
    }
    update() {
      this.x -= this.speed;
    }
    draw() {
      ctx.fillStyle = "#0f0";
      ctx.fillRect(this.x, 0, this.w, this.top);
      ctx.fillRect(this.x, H - this.bottom, this.w, this.bottom);
    }
    hits(bird) {
      return (
        bird.x + bird.radius > this.x &&
        bird.x - bird.radius < this.x + this.w &&
        (bird.y - bird.radius < this.top || bird.y + bird.radius > H - this.bottom)
      );
    }
  }

  class BloodParticle {
    constructor(x, y) {
      this.x = x;
      this.y = y;
      this.vx = (Math.random() - 0.5) * 10;
      this.vy = (Math.random() - 0.5) * 10;
      this.alpha = 1;
    }
    update() {
      this.x += this.vx;
      this.y += this.vy;
      this.vy += 0.2;
      this.alpha -= 0.02;
    }
    draw() {
      bloodCtx.fillStyle = `rgba(255, 0, 0, ${this.alpha})`;
      bloodCtx.beginPath();
      bloodCtx.arc(this.x, this.y, 4, 0, Math.PI * 2);
      bloodCtx.fill();
    }
  }

  function createBloodFountain(x, y) {
    for(let i=0; i<30; i++){
      bloodParticles.push(new BloodParticle(x, y));
    }
  }

  function updateBloodParticles() {
    bloodCtx.clearRect(0, 0, W, H);
    for(let i = bloodParticles.length - 1; i >= 0; i--){
      let p = bloodParticles[i];
      p.update();
      p.draw();
      if(p.alpha <= 0){
        bloodParticles.splice(i, 1);
      }
    }
  }

  function shakeScreen() {
    let shake = 0;
    const interval = setInterval(() => {
      shake++;
      canvas.style.transform = `translate(${(Math.random() - 0.5) * 10}px, ${(Math.random() - 0.5) * 10}px)`;
      if(shake > 10){
        clearInterval(interval);
        canvas.style.transform = "translate(0, 0)";
      }
    }, 50);
  }

  function gameLoop() {
    if(!checkOrientation()) return;

    ctx.clearRect(0, 0, W, H);
    bird.update();
    bird.draw();

    if(!gameOver){
      if(frameCount % 100 === 0){
        obstacles.push(new Obstacle());
      }
      for(let i = obstacles.length - 1; i >= 0; i--){
        obstacles[i].update();
        obstacles[i].draw();

        if(obstacles[i].hits(bird)){
          bird.dead = true;
          gameOver = true;
          createBloodFountain(bird.x, bird.y);
          shakeScreen();
        }

        if(obstacles[i].x + obstacles[i].w < 0){
          obstacles.splice(i, 1);
          score++;
          if(difficultyIncrement < maxDifficulty){
            speed += 0.2;
            difficultyIncrement++;
          }
        }
      }
    } else {
      ctx.fillStyle = "#fff";
      ctx.font = "36px sans-serif";
      ctx.fillText("Game Over!", W / 2 - 100, H / 2);
    }

    ctx.fillStyle = "#fff";
    ctx.font = "24px sans-serif";
    ctx.fillText("Score: " + score, 20, 40);

    updateBloodParticles();
    frameCount++;
    requestAnimationFrame(gameLoop);
  }

  let frameCount = 0;

  function startGame() {
    loading.style.display = "block";
    setTimeout(() => {
      loading.style.display = "none";
      bird = new Bird();
      obstacles = [];
      score = 0;
      speed = 2.2;
      difficultyIncrement = 0;
      gameOver = false;
      gameStarted = true;
      gameLoop();
    }, loadingDuration);
  }

  window.addEventListener("resize", () => {
    resize();
    checkOrientation();
  });

  window.addEventListener("click", () => {
    if(!gameStarted){
      startGame();
    } else {
      bird.flap();
    }
  });

  window.addEventListener("touchstart", () => {
    if(!gameStarted){
      startGame();
    } else {
      bird.flap();
    }
  });

  checkOrientation();
</script>
</body>
</html>
